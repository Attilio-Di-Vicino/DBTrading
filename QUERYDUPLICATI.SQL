-- TRIGGER 6
SELECT CF_UTENTE
FROM CARTA_DI_CREDITO
WHERE NUMERO_CARTA IN (
    SELECT NUMERO_CARTA_C
    FROM COLLEGATO
    WHERE ID_CONTO_VIRTUALE_C = '38480029763762467178' AND NOME_PIATTAFORMA_C = 'BITPANDA'
);
        
        
SELECT CF_UTENTE
    FROM CARTA_DI_CREDITO CC JOIN COLLEGATO C2 ON CC.NUMERO_CARTA = C2.NUMERO_CARTA_C
        WHERE C2.ID_CONTO_VIRTUALE_C = '38480029763762467178' AND C2.NOME_PIATTAFORMA_C = 'BITPANDA';

-- TRIGGER 8
SELECT COUNT(*)
--    INTO CONTA
FROM UNITO
WHERE NOME_EXCHANGE_U = 'UNISWAP' AND INDIRIZZO_U IN (
    SELECT INDIRIZZO_A
    FROM ASSOCIATO
    WHERE ID_CONTO_VIRTUALE_A = '38480029763762467178' AND NOME_PIATTAFORMA_A = 'BITPANDA'
);
    
SELECT COUNT(*)
    FROM UNITO U JOIN ASSOCIATO A1 ON  U.NOME_EXCHANGE_U = 'UNISWAP' AND U.INDIRIZZO_U IN A1.INDIRIZZO_A
        WHERE A1.ID_CONTO_VIRTUALE_A = '38480029763762467178' AND A1.NOME_PIATTAFORMA_A = 'BITPANDA';

-- PROCEDURA 1
SELECT NUMERO_CARTA_C,NOME_PIATTAFORMA_C,ID_CONTO_VIRTUALE_C
FROM COLLEGATO
WHERE NUMERO_CARTA_C IN (
    SELECT NUMERO_CARTA
    FROM CARTA_DI_CREDITO
    WHERE DATA_DI_SCADENZA < SYSDATE
);

SELECT NUMERO_CARTA_C,NOME_PIATTAFORMA_C,ID_CONTO_VIRTUALE_C
    FROM COLLEGATO C1 JOIN CARTA_DI_CREDITO CDC ON C1.NUMERO_CARTA_C = CDC.NUMERO_CARTA
        WHERE CDC.DATA_DI_SCADENZA < SYSDATE;

-- PROCEDURE 2
SELECT NOME,COGNOME
--INTO NOM_,COGN_
FROM UTENTE
WHERE CF = (
    SELECT CF_UTENTE
    FROM CARTA_DI_CREDITO
    WHERE NUMERO_CARTA = (
        SELECT NUMERO_CARTA_C
        FROM COLLEGATO
        WHERE ID_CONTO_VIRTUALE_C = '38480029763762467178' AND NOME_PIATTAFORMA_C = 'BITPANDA'
        FETCH FIRST 1 ROWS ONLY
    )
);
        
SELECT NOME,COGNOME
    FROM UTENTE U JOIN (
        SELECT CF_UTENTE
            FROM CARTA_DI_CREDITO CDC JOIN COLLEGATO C1 ON CDC.NUMERO_CARTA = C1.NUMERO_CARTA_C
                WHERE C1.ID_CONTO_VIRTUALE_C = '38480029763762467178' AND C1.NOME_PIATTAFORMA_C = 'BITPANDA'
                FETCH FIRST 1 ROWS ONLY
    ) CDC ON U.CF = CDC.CF_UTENTE;

-- PROCEDURE 3
-- STESSA QUERY PROCEDURE 2 IDENTICA

-- RPOCEDURA 4
SELECT ID_CONTO_VIRTUALE_C,NOME_PIATTAFORMA_C
FROM COLLEGATO
WHERE NUMERO_CARTA_C IN (
    SELECT NUMERO_CARTA
    FROM CARTA_DI_CREDITO
    WHERE CARTA_DI_CREDITO.CF_UTENTE = 'RSSLCU80P15F839C'
);


SELECT ID_CONTO_VIRTUALE_C,NOME_PIATTAFORMA_C
    FROM COLLEGATO C1 JOIN CARTA_DI_CREDITO CDC ON C1.NUMERO_CARTA_C = CDC.NUMERO_CARTA
        WHERE CDC.CF_UTENTE = 'RSSLCU80P15F839C';

-- PROCEDURE 5

SELECT TIPO_MOVIMENTO,QUANTITA_M,DATA_M,NUMERO_CARTA_M,FEE_M
FROM MOVIMENTO 
WHERE NUMERO_CARTA_M IN (
    SELECT NUMERO_CARTA
    FROM CARTA_DI_CREDITO
    WHERE CF_UTENTE = 'RSSLCU80P15F839C'
)
ORDER BY DATA_M ASC;

SELECT TIPO_MOVIMENTO,QUANTITA_M,DATA_M,NUMERO_CARTA_M,FEE_M
    FROM MOVIMENTO M1 JOIN CARTA_DI_CREDITO CDC ON M1.NUMERO_CARTA_M = CDC.NUMERO_CARTA
        WHERE CDC.CF_UTENTE = 'RSSLCU80P15F839C'
            ORDER BY DATA_M ASC;

-- PROCEDURE 5
SELECT VALUTA_OTTENUTA,QUANTITA_OTTENUTA,VALUTA_SCAMBIATA,QUANTITA_SCAMBIATA,DATA_S,FEE_S
FROM SCAMBIO
WHERE ID_CONTO_VIRTUALE_S IN (
    SELECT ID_CONTO_VIRTUALE_C
    FROM COLLEGATO
    WHERE NUMERO_CARTA_C IN (
        SELECT NUMERO_CARTA
        FROM CARTA_DI_CREDITO
        WHERE CF_UTENTE = 'VRDLGU79M19F839M'
    )
) AND NOME_PIATTAFORMA_S IN (
    SELECT NOME_PIATTAFORMA_C
    FROM COLLEGATO
    WHERE NUMERO_CARTA_C IN (
        SELECT NUMERO_CARTA
        FROM CARTA_DI_CREDITO
        WHERE CF_UTENTE = 'VRDLGU79M19F839M'
    )
)
ORDER BY DATA_S ASC;
    

    
SELECT VALUTA_OTTENUTA,QUANTITA_OTTENUTA,VALUTA_SCAMBIATA,QUANTITA_SCAMBIATA,DATA_S,FEE_S
    FROM SCAMBIO S JOIN (
        SELECT ID_CONTO_VIRTUALE_C
            FROM COLLEGATO C1 JOIN CARTA_DI_CREDITO CDC ON C1.NUMERO_CARTA_C = CDC.NUMERO_CARTA
                WHERE CDC.CF_UTENTE = 'VRDLGU79M19F839M'
    ) C1 ON S.ID_CONTO_VIRTUALE_S = C1.ID_CONTO_VIRTUALE_C
        WHERE NOME_PIATTAFORMA_S IN (
            SELECT NOME_PIATTAFORMA_C
                FROM COLLEGATO C2 JOIN CARTA_DI_CREDITO CDC ON C2.NUMERO_CARTA_C = CDC.NUMERO_CARTA
                    WHERE CDC.CF_UTENTE = 'VRDLGU79M19F839M'
        ) ORDER BY DATA_S ASC;