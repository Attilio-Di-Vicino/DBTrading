DROP VIEW ESTRATTO_CONTO;
DROP VIEW ESTRATTO_CRYPTO;

CREATE VIEW ESTRATTO_CONTO(CODICEFISCALE) AS
    SELECT TIPO_MOVIMENTO,QUANTITA_M,DATA_M,NUMERO_CARTA_M
    FROM MOVIMENTO 
    WHERE NUMERO_CARTA_M IN (
        SELECT NUMERO_CARTA
        FROM CARTA_DI_CREDITO
        WHERE CF_UTENTE = CODICEFISCALE
    )
    ORDER BY DATA_M ASC;

CREATE VIEW ESTRATTO_CRYPTO(CODICEFISCALE) AS
    SELECT VALUTA_OTTENUTA,QUANTITA_OTTENUTA,VALUTA_SCAMBIATA,QUANTITA_SCAMBIATA,DATA_S
    FROM SCAMBIO
    WHERE ID_CONTO_VIRTUALE_S IN (
        SELECT ID_CONTO_VIRTUALE_C
        FROM COLLEGATO
        WHERE NUMERO_CARTA_C IN (
            SELECT NUMERO_CARTA
            FROM CARTA_DI_CREDITO
            WHERE CF_UTENTE = 'DSRLRD90A01F839V'
        )
    ) AND NOME_PIATTAFORMA_S IN (
        SELECT NOME_PIATTAFORMA_C
        FROM COLLEGATO
        WHERE NUMERO_CARTA_C IN (
            SELECT NUMERO_CARTA
            FROM CARTA_DI_CREDITO
            WHERE CF_UTENTE = 'DSRLRD90A01F839V'
        )
    )
    ORDER BY DATA_S ASC;


/*
    VISUALIZZA LA PIATTAFORMA DI EXCHANGE E L'EXCHANGE DECENTRALIZZATO PIU' UTILIZZATI DAI TRADER
*/
/*
    VISUALIZZA LA PIATTAFORMA DI EXCHANGE E L'EXCHANGE DECENTRALIZZATO PIU' UTILIZZATI DAI TRADER CON ANNESSO PROPIETA
    VISUALIZZA IN ORDIRE DECRESCENTE IN BASE AGLI SCAMBI EFFETTUATI I DEX CON ANNESSI PROPRIETARI
*/

SELECT  INDIRIZZO_U,TX_HASH
    FROM UNITO U JOIN SCAMBIO S ON U.NOME_EXCHANGE_U = S.NOME_EXCHANGE_DEX
        WHERE INDIRIZZO_U = (
            SELECT INDIRIZZO
                FROM ASSOCIATO
        );

SELECT INDIRIZZO_A,TX_HASH
    FROM ASSOCIATO A JOIN SCAMBIO S ON A.ID_CONTO_VIRTUALE_A = S.ID_CONTO_VIRTUALE_S AND A.NOME_PIATTAFORMA_A = S.NOME_PIATTAFORMA_S;