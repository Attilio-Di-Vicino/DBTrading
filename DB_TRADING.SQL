DROP TABLE UTENTE CASCADE CONSTRAINT;
DROP TABLE VALUTAZIONE_RISCHIO;
DROP TABLE CONTO_CORRENTE;
DROP TABLE COLLEGATO;
DROP TABLE CONTO_VIRTUALE CASCADE CONSTRAINT; -- capire bene CASCADE CONSTRAINT
DROP TABLE MOVIMENTO;
DROP TABLE DEPOSITO;
DROP TABLE PRELIEVO;
DROP TABLE ASSOCIATO;
DROP TABLE WALLET_DECENTRALIZZATO;
DROP TABLE UNITO;
DROP TABLE EXCHANGE_DECENTRALIZZATO;
DROP TABLE REWARDS;
DROP TABLE PIATTAFORMA_EXCHANGE;
DROP TABLE OPERAZIONE;
DROP TABLE ACQUISTO;
DROP TABLE VENDITA;

CREATE TABLE UTENTE(
    CF              CHAR(16)    PRIMARY KEY,
    DATA_DI_NASCITA DATE, -- AGGIUNGERE NOT NULL A TUTTI I DATE
    NAZIONALITA     VARCHAR(20),
    NOME            VARCHAR(20),
    COGNOME         VARCHAR(20)
)

CREATE TABLE VALUTAZIONE_RISCHIO(
    CATEGORIA   VARCHAR(15) , -- NON PUO ESSERE PRIMARY KEY O CHIAVE DEBOLE 
    BUDGET      NUMBER(9,0) NOT NULL, -- FINO A 9 NUMERI RAPPRESENTABILI
    RISCHIO     NUMBER(2,0) NOT NULL, -- NON PUO' AVERE IL 100% DI RISCHIO (VALORE ESPRESSO IN %)
    CF_UTENTE   CHAR(16)    NOT NULL,
    CONSTRAINT  FK_UTENTE FOREIGN KEY (CF_UTENTE) REFERENCES UTENTE(CF) ON DELETE CASCADE -- CHIAVE ESTERNA CHE FA RIFERIMENTO ALLA TABELLA UTENTE
    -- AGGIUNGERE IL CHECK PER LA CATEGORIA
)

CREATE TABLE CONTO_CORRENTE(
    NUMERO_CONTO        CHAR(16)    PRIMARY KEY,
    CVV                 CHAR(3)     NOT NULL    UNIQUE,
    DATA_DI_SCADENZA    DATE,
    CF_UTENTE           CHAR(16)    NOT NULL,
    CONSTRAINT  FK_UTENTE2 FOREIGN KEY (CF_UTENTE) REFERENCES UTENTE(CF) ON DELETE CASCADE -- FK_UTENTE2 PERCHE I NOMI DEVONO ESSERE DIVERSI
)

CREATE TABLE CONTO_VIRTUALE(
    ID              VARCHAR(30) PRIMARY KEY, -- VARCHAR(30) PERCHE POSSIAMO AVERE ID DIVERSI DI PIATTAFORME DIVERSE
    DATA_CREAZIONE  DATE
)
-- DA CAPIRE COME INSERIRE DUE CHIAVI PRIMARIE

CREATE TABLE COLLEGATO(
    ID_CONTO_VIRTUALE_C   VARCHAR(30),
    NUMERO_CONTO_C      CHAR(16),    --PRIMARY KEY,

    CONSTRAINT PK_COLLEGATO PRIMARY KEY(ID_CONTO_VIRTUALE_C,NUMERO_CONTO_C),
    CONSTRAINT  FK_ID FOREIGN KEY (ID_CONTO_VIRTUALE_C) REFERENCES CONTO_VIRTUALE(ID) ON DELETE CASCADE,
    CONSTRAINT  FK_NUMERO_CONTO FOREIGN KEY (NUMERO_CONTO_C) REFERENCES CONTO_CORRENTE(NUMERO_CONTO) ON DELETE CASCADE
)

CREATE TABLE MOVIMENTO(
    ID_ORDINE               CHAR(20)        PRIMARY KEY,
    QUANTITA                NUMBER(9,2)     NOT NULL,
    DATA_M                  TIMESTAMP, -- DA CAMBIARE EE/R
    --ORARIO                  DATE, -- DA CAMBIARE TIPO DI DATO IN TIME
    FEE                     NUMBER(9,2)     NOT NULL,
    TIPO_MOVIMENTO          NUMBER(1,0)     NOT NULL, -- AGGIUNGERE CHECK 1 E 2
    ID_CONTO_VIRTUALE_M     VARCHAR(30)     NOT NULL,
    CONSTRAINT  FK_ID_CONTO_VIRTUALE FOREIGN KEY (ID_CONTO_VIRTUALE_M) REFERENCES CONTO_VIRTUALE(ID) ON DELETE CASCADE
)
-- VALUTARE ATTRIBUTI PRELIEVO E DEPOSITO