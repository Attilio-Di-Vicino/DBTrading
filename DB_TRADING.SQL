DROP TABLE UTENTE CASCADE CONSTRAINT;
DROP TABLE VALUTAZIONE_RISCHIO;
DROP TABLE CONTO_CORRENTE;
DROP TABLE COLLEGATO;
DROP TABLE CONTO_VIRTUALE CASCADE CONSTRAINT; -- capire bene CASCADE CONSTRAINT
DROP TABLE MOVIMENTO;
-- DROP TABLE DEPOSITO;
-- DROP TABLE PRELIEVO;
DROP TABLE WALLET_DECENTRALIZZATO;
DROP TABLE ASSOCIATO;
DROP TABLE UNITO;
DROP TABLE EXCHANGE_DECENTRALIZZATO;
DROP TABLE REWARDS;
DROP TABLE PIATTAFORMA_EXCHANGE;
DROP TABLE OPERAZIONE;
DROP TABLE ACQUISTO;
DROP TABLE VENDITA;

CREATE TABLE UTENTE(
    CF              CHAR(16)    PRIMARY KEY,
    DATA_DI_NASCITA DATE        NOT NULL,
    NAZIONALITA     VARCHAR(20) NOT NULL,
    NOME            VARCHAR(20) NOT NULL,
    COGNOME         VARCHAR(20) NOT NULL
)

CREATE TABLE VALUTAZIONE_RISCHIO(
    CATEGORIA   VARCHAR(15) NOT NULL, -- CHIAVE DEBOLE 
    BUDGET      NUMBER(9,0) NOT NULL, -- FINO A 9 NUMERI RAPPRESENTABILI
    RISCHIO     NUMBER(2,0) NOT NULL, -- NON PUO' AVERE IL 100% DI RISCHIO (VALORE ESPRESSO IN %)
    CF_UTENTE   CHAR(16)    NOT NULL, -- CHIAVE ESTERNA

    CONSTRAINT  PK_VALUTAZIONE_RISCHIO PRIMARY KEY(CATEGORIA,CF_UTENTE),
    CONSTRAINT  FK_UTENTE FOREIGN KEY (CF_UTENTE) REFERENCES UTENTE(CF) ON DELETE CASCADE,
    CONSTRAINT  CATEGORIE_AMMESSE CHECK ( (CATEGORIA) IN ('INTRADAY','SCALPER','BUY & HOLD') )
)

CREATE TABLE CONTO_CORRENTE(
    NUMERO_CONTO        CHAR(16)    PRIMARY KEY,
    CVV                 CHAR(3)     NOT NULL    UNIQUE,
    DATA_DI_SCADENZA    DATE        NOT NULL,
    CF_UTENTE           CHAR(16)    NOT NULL, -- CHIAVE ESTERNA
    CONSTRAINT  FK_UTENTE2 FOREIGN KEY (CF_UTENTE) REFERENCES UTENTE(CF) ON DELETE CASCADE
)

CREATE TABLE CONTO_VIRTUALE(
    ID              VARCHAR(30) PRIMARY KEY, -- VARCHAR(30) PERCHE POSSIAMO AVERE ID DIVERSI DI PIATTAFORME DIVERSE
    DATA_CREAZIONE  DATE        NOT NULL
)

CREATE TABLE COLLEGATO(
    ID_CONTO_VIRTUALE_C   VARCHAR(30), -- PRIMARY KEY
    NUMERO_CONTO_C        CHAR(16),    -- PRIMARY KEY

    CONSTRAINT  PK_COLLEGATO PRIMARY KEY (ID_CONTO_VIRTUALE_C,NUMERO_CONTO_C),
    CONSTRAINT  FK_ID FOREIGN KEY (ID_CONTO_VIRTUALE_C) REFERENCES CONTO_VIRTUALE(ID) ON DELETE CASCADE,
    CONSTRAINT  FK_NUMERO_CONTO FOREIGN KEY (NUMERO_CONTO_C) REFERENCES CONTO_CORRENTE(NUMERO_CONTO) ON DELETE CASCADE
)

CREATE TABLE MOVIMENTO(
    ID_ORDINE               CHAR(20)        PRIMARY KEY,
    QUANTITA                NUMBER(9,2)     NOT NULL,
    DATA_M                  TIMESTAMP,                -- DA AGGIUNGERE NOT NULL
    FEE                     NUMBER(9,2)     NOT NULL,
    TIPO_MOVIMENTO          NUMBER(1,0)     NOT NULL, -- PUO ESSERE SOLO 1 O 2
    ID_CONTO_VIRTUALE_M     VARCHAR(30)     NOT NULL, 

    CONSTRAINT  FK_ID_CONTO_VIRTUALE FOREIGN KEY (ID_CONTO_VIRTUALE_M) REFERENCES CONTO_VIRTUALE(ID) ON DELETE CASCADE,
    CONSTRAINT  MOVIMENTO_CONSENTITO CHECK ( QUANTITA <> 0 ),
    CONSTRAINT TIPO_MOVIMENTO_CONSENTITO CHECK ( TIPO_MOVIMENTO = 1 AND TIPO_MOVIMENTO = 2 )
)

CREATE TABLE WALLET_DECENTRALIZZATO(
    
)

CREATE TABLE ASSOCIATO(
    ID_CONTO_VIRTUALE_A VARCHAR(30), -- CHIAVE PRIMARIA
    INDIRIZZO_W         CHAR(42),    -- CHIAVE PRIMARIA

    CONSTRAINT  PK_ASSOCIATO PRIMARY KEY (ID_CONTO_VIRTUALE_A,INDIRIZZO_W),
    CONSTRAINT  FK_ID_A FOREIGN KEY (ID_CONTO_VIRTUALE_A) REFERENCES CONTO_VIRTUALE(ID) ON DELETE CASCADE,
    CONSTRAINT  FK_INDIRIZZO_W FOREIGN KEY ()
)