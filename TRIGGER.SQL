/*
    L'UTENTE DEVE ESSERE MAGGIORENNE
    TESTATO E FUNZIONANTE
*/
CREATE OR REPLACE TRIGGER VERIFICA_ETA_UTENTE
BEFORE INSERT ON UTENTE
FOR EACH ROW
DECLARE
    MINORENNE EXCEPTION;
BEGIN

    IF (SYSDATE - :NEW.DATA_DI_NASCITA) / 365.25 < 18 THEN
        RAISE MINORENNE;
    END IF;

EXCEPTION
    WHEN MINORENNE 
        THEN :NEW.CF := NULL; -- BLOCCO INSERIMENTO

END VERIFICA_ETA_UTENTE;

/*
    ALL'INSERIMENTO DELLA CARTA, ESSA NON DEVE ESSERE SCADUTA
    TESTATO E FUNZIONANTE
*/
CREATE OR REPLACE TRIGGER VERIFICA_CARTA_SCADUTA
BEFORE INSERT ON CONTO_CORRENTE
FOR EACH ROW
DECLARE
    CARTASCADUTA EXCEPTION;
BEGIN

    IF :NEW.DATA_DI_SCADENZA < SYSDATE THEN
        RAISE CARTASCADUTA;
    END IF;

EXCEPTION
    WHEN CARTASCADUTA 
        THEN :NEW.NUMERO_CONTO := NULL; -- BLOCCO INSERIMENTO

END VERIFICA_CARTA_SCADUTA;

/*
    CONTROLLO SALDO MOVIMENTO DA MODIFICARE
    NEL FRATTEMPTO TESTATO E FUNZIONANTE, MA DA MODIFICARE
*/
CREATE OR REPLACE TRIGGER CONTROLLO_SALDO
BEFORE INSERT ON MOVIMENTO
FOR EACH ROW
--DECLARE     SALDO   NUMBER;
BEGIN
    IF 1000 < :NEW.QUANTITA
    THEN 
        RAISE_APPLICATION_ERROR(-2061,'SALDO NON SUFFICIENTE');
    END IF;
END CONTROLLO_SALDO;